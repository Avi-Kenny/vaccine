<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Basic package workflow â€¢ vaccine</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Basic package workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vaccine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/vaccine.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Avi-Kenny/vaccine/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basic package workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Avi-Kenny/vaccine/blob/master/vignettes/vaccine.Rmd" class="external-link"><code>vignettes/vaccine.Rmd</code></a></small>
      <div class="d-none name"><code>vaccine.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://avi-kenny.github.io/vaccine/">vaccine</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; vaccine (version 1.3.0).</span></span>
<span><span class="co">#&gt; Type ?vaccine to get started.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<p>The <code>load_data</code> function takes in raw data and creates a
data object that can be accepted by various estimation functions. We use
publicly-avaliable data from the HVTN 505 HIV vaccine efficacy trial as
our example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hvtn505</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_data.html">load_data</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="st">"HIVwk28preunblfu"</span>,</span>
<span>  event <span class="op">=</span> <span class="st">"HIVwk28preunbl"</span>,</span>
<span>  vacc <span class="op">=</span> <span class="st">"trt"</span>,</span>
<span>  marker <span class="op">=</span> <span class="st">"IgG_V2"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>,<span class="st">"BMI"</span>,<span class="st">"bhvrisk"</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="st">"wt"</span>,</span>
<span>  ph2 <span class="op">=</span> <span class="st">"casecontrol"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">hvtn505</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>summary_stats</code> function gives us some useful
summaries of the dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary_stats.html">summary_stats</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of subjects (vaccine group, phase-1): 1161</span></span>
<span><span class="co">#&gt; Number of subjects (placebo group, phase-1): 1141</span></span>
<span><span class="co">#&gt; Number of subjects (vaccine group, phase-2): 150</span></span>
<span><span class="co">#&gt; Number of subjects (placebo group, phase-2): 39</span></span>
<span><span class="co">#&gt; Number of events (vaccine group, phase-1): 27</span></span>
<span><span class="co">#&gt; Number of events (placebo group, phase-1): 21</span></span>
<span><span class="co">#&gt; Number of events (vaccine group, phase-2): 25</span></span>
<span><span class="co">#&gt; Number of events (placebo group, phase-2): 19</span></span>
<span><span class="co">#&gt; Proportion of subjects with an event (vaccine group, phase- 1): 0.02326</span></span>
<span><span class="co">#&gt; Proportion of subjects with an event (placebo group, phase- 1): 0.0184</span></span>
<span><span class="co">#&gt; Proportion of subjects with an event (vaccine group, phase- 2): 0.16667</span></span>
<span><span class="co">#&gt; Proportion of subjects with an event (placebo group, phase- 2): 0.48718</span></span></code></pre></div>
<p>The <code>est_overall</code> function allows us to estimate overall
risk in the placebo and vaccine groups, as well as estimate vaccine
efficacy, using either a nonparametric Kaplan-Meier estimator or a
marginalized Cox model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/est_overall.html">est_overall</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">dat</span>, t_0<span class="op">=</span><span class="fl">578</span>, method<span class="op">=</span><span class="st">"KM"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   stat   group         est          se    ci_lower   ci_upper</span></span>
<span><span class="co">#&gt; 1 risk vaccine  0.04067009 0.008230842  0.02506853 0.05602199</span></span>
<span><span class="co">#&gt; 2 risk placebo  0.02879861 0.006563785  0.01622360 0.04121288</span></span>
<span><span class="co">#&gt; 3   ve    both -0.41222411 0.430451788 -1.56659984 0.22294979</span></span>
<span><span class="fu"><a href="../reference/est_overall.html">est_overall</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">dat</span>, t_0<span class="op">=</span><span class="fl">578</span>, method<span class="op">=</span><span class="st">"Cox"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   stat   group         est          se    ci_lower   ci_upper</span></span>
<span><span class="co">#&gt; 1 risk vaccine  0.04177642 0.008111679  0.02847302 0.06090588</span></span>
<span><span class="co">#&gt; 2 risk placebo  0.02938706 0.006486545  0.01901930 0.04514638</span></span>
<span><span class="co">#&gt; 3   ve    both -0.42159246 0.417915188 -1.52937491 0.20101796</span></span></code></pre></div>
<p>The <code>est_ce</code> function allows us to compute controlled
effects curves; see <a href="https://pubmed.ncbi.nlm.nih.gov/37850938/" class="external-link">Gilbert, Fong, Kenny,
and Carone 2022</a> for more detail.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ests_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_ce.html">est_ce</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">dat</span>, type<span class="op">=</span><span class="st">"Cox"</span>, t_0<span class="op">=</span><span class="fl">578</span><span class="op">)</span></span>
<span><span class="va">ests_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_ce.html">est_ce</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">dat</span>, type<span class="op">=</span><span class="st">"NP"</span>, t_0<span class="op">=</span><span class="fl">578</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nnls</span></span>
<span><span class="co">#&gt; Loading required package: gam</span></span>
<span><span class="co">#&gt; Loading required package: splines</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loaded gam 1.22-5</span></span>
<span><span class="co">#&gt; Super Learner</span></span>
<span><span class="co">#&gt; Version: 2.0-29</span></span>
<span><span class="co">#&gt; Package created on 2024-02-06</span></span>
<span><span class="co">#&gt; Loading required namespace: ranger</span></span></code></pre></div>
<p>The <code>plot_ce</code> function produces basic plots of CR or CVE
curves.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ce.html">plot_ce</a></span><span class="op">(</span><span class="va">ests_cox</span>, <span class="va">ests_np</span><span class="op">)</span></span></code></pre></div>
<p><img src="vaccine_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Use the <code>density</code> option to add a kernel density estimate
of the distribution of the marker to the plot background.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ce.html">plot_ce</a></span><span class="op">(</span><span class="va">ests_cox</span>, <span class="va">ests_np</span>, density_type<span class="op">=</span><span class="st">"kde"</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="vaccine_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Use the <code>trim</code> function to truncate the display of the
curves, based on quantiles of the marker distribution. It is recommended
to truncate the display of the nonparametric curves, as estimates can be
biased towards the endpoints of the marker distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ests_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trim.html">trim</a></span><span class="op">(</span><span class="va">ests_cox</span>, dat<span class="op">=</span><span class="va">dat</span>, quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ests_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trim.html">trim</a></span><span class="op">(</span><span class="va">ests_np</span>, dat<span class="op">=</span><span class="va">dat</span>, quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_ce.html">plot_ce</a></span><span class="op">(</span><span class="va">ests_cox</span>, <span class="va">ests_np</span>, density_type<span class="op">=</span><span class="st">"kde"</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="vaccine_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Plots generated using <code>plot_ce</code> can be further customized
using <code>ggplot2</code> functions. For example, we change the plot
labels and colors as follows.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_ce.html">plot_ce</a></span><span class="op">(</span><span class="va">ests_cox</span>, <span class="va">ests_np</span>, density_type<span class="op">=</span><span class="st">"kde"</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"IgG Binding to V1V2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cox model"</span>, <span class="st">"Nonparametric"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorchid3"</span>, <span class="st">"deepskyblue3"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cox model"</span>, <span class="st">"Nonparametric"</span><span class="op">)</span>,</span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorchid3"</span>, <span class="st">"deepskyblue3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">colour</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">colour</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="vaccine_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<p>To view estimates in tabular format, use the <code>as_table</code>
function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ests_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_table.html">as_table</a></span><span class="op">(</span><span class="va">ests_cox</span>, <span class="va">ests_np</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ests_table</span><span class="op">)</span></span>
<span><span class="co">#&gt;            x         y   ci_lower  ci_upper curve</span></span>
<span><span class="co">#&gt; 1 0.02356062 0.1531213 0.07439247 0.2891413    NA</span></span>
<span><span class="co">#&gt; 2 0.04712124 0.1513980 0.07449740 0.2833745    NA</span></span>
<span><span class="co">#&gt; 3 0.07068186 0.1496917 0.07459291 0.2777089    NA</span></span>
<span><span class="co">#&gt; 4 0.09424248 0.1480023 0.07467853 0.2721456    NA</span></span>
<span><span class="co">#&gt; 5 0.11780310 0.1463297 0.07475377 0.2666853    NA</span></span>
<span><span class="co">#&gt; 6 0.14136372 0.1446737 0.07481808 0.2613289    NA</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Avi Kenny.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
